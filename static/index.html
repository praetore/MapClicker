<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Google Maps Clicker</title>
    <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <!-- Include Google Maps JS API -->
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?
key=AIzaSyDstP10zYrVkV0gWORTQITPLycxuxIKUeE&sensor=false">
    </script>
    <style type="text/css">
        body {
            font-family: Arial, sans-serif;
        }
        html {
            height: 100%
        }
        body {
            height: 100%;
            margin: 0;
        }
        #mapDiv {
            width: 100%;
            height: 100%;
        }
        #num {
            float: left;
            margin: 10px;
        }
    </style>
    <!-- Map creation is here -->
    <script type="text/javascript">
        var infowindow = null;
        //Defining map as a global variable to access from
        //other functions
        var lat, lng, map, num;

        $.ajax({
            url: 'api/datapoints',
            type: 'GET',
            success: function (data) {
                num = data.num_results;
            }
        });

        $('#num').html(num + ' coordinaten geindexeerd');

        function initMap() {
            //Enabling new cartography and themes
            google.maps.visualRefresh = true;
            //Setting starting options of map
            var mapOptions = {
                center: new google.maps.LatLng(51.958581, 4.024580),
                zoom: 13,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            //Getting map DOM element
            var mapElement = document.getElementById('mapDiv');
            //Creating a map with DOM element which is just obtained
            map = new google.maps.Map(mapElement, mapOptions);

            google.maps.event.addListener(map, 'click', function (e) {
                lat = e.latLng.lat();
                lng = e.latLng.lng();

                num++;
                $('#num').html(num + ' coordinaten geindexeerd');

                postDataToServer(lat, lng);
            });
        }
        google.maps.event.addDomListener(window, 'load',
                initMap);

        var postDataToServer = function (lat, long) {
            var schematic = $('#schematic').val();
            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                url: 'api/datapoints',
                type: 'POST',
                data: JSON.stringify({
                    "lat": lat,
                    "long": long,
                    "schematic": schematic
                })
            });
        };
    </script>
</head>
<body>
<div id="selectSchematic">
    <select name="schematic" id="schematic">
        <option value="Gebouw 1">Gebouw 1</option>
        <option value="Gebouw 2">Gebouw 2</option>
        <option value="Gebouw 3">Gebouw 3</option>
        <option value="Gebouw 4">Gebouw 4</option>
        <option value="Gebouw 5">Gebouw 5</option>
    </select>
    <p id="num"></p>
</div>
<div id="mapDiv"></div>
</body>
</html>